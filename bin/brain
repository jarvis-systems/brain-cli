#!/usr/bin/env php
<?php

defined("DS") || define("DS", DIRECTORY_SEPARATOR);

if (is_file(__DIR__ . DS . '..' . DS . 'vendor' . DS . 'autoload.php')) {
    require __DIR__ . DS . '..' . DS . 'vendor' . DS . 'autoload.php';
} else if (is_file(__DIR__ . DS . '..' . DS . '..' . DS . 'vendor' . DS . 'autoload.php')) {
    require __DIR__ . DS . '..' . DS . '..' . DS . 'vendor' . DS . 'autoload.php';
} else if (is_file(__DIR__ . DS . '..' . DS . 'autoload.php')) {
    require __DIR__ . DS . '..' . DS . 'autoload.php';
} else if (is_file(__DIR__ . DS . '..' . DS . '..' . DS . 'autoload.php')) {
    require __DIR__ . DS . '..' . DS . '..' . DS . 'autoload.php';
} else {
    fwrite(STDERR, "You must set up the project dependencies using Composer." . PHP_EOL);
    exit(1);
}

use BrainCLI\ServiceProvider;
use BrainCLI\Foundation\Application as LaravelApplication;
use Illuminate\Contracts\Container\BindingResolutionException;

defined("OK") || define("OK", 0);
defined("ERROR") || define("ERROR", 1);

$laravel = new LaravelApplication();
$app = ServiceProvider::bootApplication($laravel);
$provider = new ServiceProvider($app, $laravel);

try {
    $provider->register();
} catch (BindingResolutionException|ReflectionException $e) {
    fwrite(STDERR, "Error: " . $e->getMessage() . PHP_EOL);
    exit($e->getCode() ?: ERROR);
}

try {
    $status = $app->run();
} catch (Exception $e) {
    fwrite(STDERR, "Error: " . $e->getMessage() . PHP_EOL);
    $status = $e->getCode() ?: ERROR;
}

exit($status);
