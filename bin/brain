#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use BrainCLI\ServiceProvider;
use BrainCLI\Foundation\Application as LaravelApplication;
use Illuminate\Contracts\Container\BindingResolutionException;

defined("DS") || define("DS", DIRECTORY_SEPARATOR);
defined("OK") || define("OK", 0);
defined("ERROR") || define("ERROR", 1);


$laravel = new LaravelApplication();
$app = ServiceProvider::bootApplication($laravel);
$provider = new ServiceProvider($app, $laravel);

try {
    $provider->register();
} catch (BindingResolutionException|ReflectionException $e) {
    fwrite(STDERR, "Error: " . $e->getMessage() . PHP_EOL);
    exit($e->getCode() ?: ERROR);
}

try {
    $status = $app->run();
} catch (Exception $e) {
    fwrite(STDERR, "Error: " . $e->getMessage() . PHP_EOL);
    $status = $e->getCode() ?: ERROR;
}

exit($status);
